---
layout: layouts/base.njk
templateClass: tmpl-kids
---

<div id="game">
    <script>
        const apiBaseUrl = "http://tttapi.herokuapp.com/api/v1"
        // NOTE: replace [X, O] with [snakeEmoji, mongooseEmoji]
        let board = '---------'
        const gameState = {
            playerTurn: 'X', // computer player is always X, goes first
            playing: false,
            winner: null
        }
        String.prototype.replaceAt = function (index, replacement) {
            return this.substring(0, index) + replacement + this.substring(index + replacement.length);
        }
        const createFullUrl = (board, player) => {
            return `${apiBaseUrl}/${board}/${player}`
        }
        const setPlayerTurn = (player) => {
            gameState.playerTurn = player
        }
        const setCell = (cellId, newValue) => {
            console.info("inside setCell", cellId)
            if (gameState.playing) { // human is always O
                const cell = document.getElementById(cellId)
                if (cell.innerText === '-') {
                    cell.innerText = newValue
                }
            }
        }
        const setBoard = (newBoard) => {
            board = newBoard
        }
        const clearBoard = () => {
            board = '---------'
        }
        const move = (board, player, location) => {
            return board.replaceAt(location, player)
        }
        const play = () => {
            let turn = 0
            console.log("playing TTT")
            gameState.playing = true
            clearBoard()
            setPlayerTurn('X')
            while (gameState.playing) {
                turn = turn + 1
                if (turn > 10) {
                    break
                }
                console.info('turn set to before:', gameState.playerTurn)
                if (gameState.playerTurn === 'X') { // computer turn
                    fetch(createFullUrl(board, gameState.playerTurn)).then(response => response.json()).then(data => {
                        console
                            .info("fetched data", data)
                            setBoard(move(board, 'X', data.recommendation))
                            console
                            .info('board after computer move', board)
                            setPlayerTurn('O') // change to human turn
                            console
                            .info('turn set to:', gameState.playerTurn)
                    })
                }
            }
            // game over
        }
        //
    </script>
    <div id="game-section">
        <table id="board">
            <tr class="row">
                <td class="cell" id="one" onclick="setCell('one', 'O')"></td>
                <td class="cell" id="two" onclick="setCell('two', 'O')"></td>
                <td class="cell" id="three" onclick="setCell('three', 'O')"></td>
            </tr>
            <tr class="row">
                <td class="cell" id="four" onclick="setCell('four', 'O')"></td>
                <td class="cell" id="five" onclick="setCell('five', 'O')"></td>
                <td class="cell" id="six" onclick="setCell('six', 'O')"></td>
            </tr>
            <tr class="row">
                <td class="cell" id="seven" onclick="setCell('seven', 'O')"></td>
                <td class="cell" id="eight" onclick="setCell('eight', 'O')"></td>
                <td class="cell" id="nine" onclick="setCell('nine', 'O')"></td>
            </tr>
        </table>
        <span>
            <button id="play-button" onclick="play()">
                Activate TTT
            </button>
        </span>
        <p id="game-state-message"></p>
    </div>
</div></div></div></div></div></div></div></div></div></div> </div>